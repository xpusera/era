<!doctype html>
<html>
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<style>
		html, body {
			margin: 0;
			padding: 0;
			width: 100%;
			height: 100%;
			background: transparent;
			overflow: hidden;
			user-select: none;
			-webkit-user-select: none;
			-webkit-touch-callout: none;
			-webkit-tap-highlight-color: rgba(0,0,0,0);
			touch-action: none;
		}
	</style>
</head>
<body>
	<script>
		(function () {
			document.addEventListener('contextmenu', function (e) { e.preventDefault(); }, { passive: false });
			document.addEventListener('selectstart', function (e) { e.preventDefault(); }, { passive: false });

			var state = {
				mode: 'ai',
				last: null,
			};

			function safeParse(s) {
				try { return JSON.parse(s); } catch (e) { return null; }
			}

			function reply(obj) {
				try { luanti.send(JSON.stringify(obj)); } catch (e) {}
			}

			luanti.on_message(function (msg) {
				var o = safeParse(msg);
				if (!o || !o.type) return;

				if (o.type === 'set_mode') {
					state.mode = (o.mode === 'entities') ? 'entities' : 'ai';
					reply({ type: 'mode', mode: state.mode });
					return;
				}

				if (o.type === 'ping') {
					reply({ type: 'pong', t: Date.now() });
					return;
				}

				state.last = o;
			});
		})();
	</script>
</body>
</html>
